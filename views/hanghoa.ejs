<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hàng hóa</title>
    <link href="/style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>


    <script defer src="script.js"></script>

</head>

<body>

    <nav class="navbar navbar-expand-xxl bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/tongquan">
                <img src="/img/navbar/logo.svg" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                My Store
            </a>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/tongquan">
                            <img src="/img/navbar/tongquan.svg">
                            Tổng quan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/hanghoa">
                            <img src="/img/navbar/box.svg">
                            Hàng hóa
                        </a>
                    </li>
                    <li class="nav-item dropdown">

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <img src="/img/navbar/giaodich.svg">
                            Giao dịch
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="/nhaphang">
                                    <img src="/img/navbar/thietlapgia.svg">
                                    Nhập hàng
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="/banhang">
                                    <img src="/img/navbar/kiemkho.svg">
                                    Bán hàng
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/doitac">
                            <img src="/img/navbar/doitac.svg">
                            Đối tác
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/nhanvien">
                            <img src="/img/navbar/nhanvien.svg">
                            Nhân viên
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/khachhang">
                            <img src="/img/navbar/khachhang.svg">
                            Khách hàng
                        </a>
                    </li>
                    </li>
                </ul>
            </div>
            <a class="nav-link" href="/login">Logout</a>
        </div>
    </nav>

    <div class="row">
        <div class="col-6 text-start">
            <p class="fs-2 mt-3 ms-4">Hàng hóa</p>
        </div>
        <div class="col-6 text-end">
            <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary mt-4 me-4" data-bs-toggle="modal"
                    data-bs-target="#exampleModal">
                    Thêm hàng hóa
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm hàng hóa</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="/hanghoa/them" method="post">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label>Tên sản phẩm</label>
                                <input type="text" name="ten" id="ten" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label>Mã phân loại</label>
                                <input type="number" name="phanLoai" id="phanLoai" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p>1 - Đồ bộ bé gái</p>
                                <p>2 - Váy đầm bé gái</p>
                                <p>3 - Áo bé gái</p>
                                <p>4 - Đồ bơi bé gái</p>
                                <p>5 - Quần Bé Gái</p>
                            </div>
                            <div class="col-md-6">
                                <p>6 - Đồ bộ bé trai</p>
                                <p>7 - Áo Bé Trai</p>
                                <p>8 - Quần bé trai</p>
                                <p>9 - Đồ bơi bé trai</p>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label>Giá Nhập</label>
                                <input type="number" name="giaNhap" id="giaNhap" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label>Giá bán</label>
                                <input type="number" name="giaBan" id="giaBan" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label>Tồn kho</label>
                                <input type="number" name="tonKho" id="tonKho" class="form-control">
                            </div>
                        </div>
                </div>
                <div class="modal-footer">
                    <div class="mb-3">
                        <input type="submit" name="submit_button" class="btn btn-primary" value=" Add">
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Chỉnh sửa thông tin hàng hóa</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="/hanghoa/chinhsua" method="post" id="updateForm">
                        <div class="form-group">
                            <label for="productId">Mã hàng:</label>
                            <span id="productId"></span>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="newName">Tên hàng</label>
                                <input type="text" name="newName" id="newName" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="newStock">Mã phân loại</label>
                                <input type="number" name="newCategory" id="newCategory" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p>1 - Đồ bộ bé gái</p>
                                <p>2 - Váy đầm bé gái</p>
                                <p>3 - Áo bé gái</p>
                                <p>4 - Đồ bơi bé gái</p>
                                <p>5 - Quần Bé Gái</p>
                            </div>
                            <div class="col-md-6">
                                <p>6 - Đồ bộ bé trai</p>
                                <p>7 - Áo Bé Trai</p>
                                <p>8 - Quần bé trai</p>
                                <p>9 - Đồ bơi bé trai</p>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="newInboundPrice">Giá nhập</label>
                                <input type="number" name="newInboundPrice" id="newInboundPrice" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="newSalePrice">Giá bán</label>
                                <input type="number" name="newOutboundPrice" id="newOutboundPrice" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="newStock">Tồn kho</label>
                                <input type="text" name="newQuantity" id="newQuantity" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <input type="hidden" name="productId" id="productIdInput" value="">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <div class="mb-3">
                        <button type="button" class="btn btn-primary" id="updateButton">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="grid-container">
        <div class="grid-item">
            <p class="fs-5 ms-2">Nhóm hàng</p>
            <form action="/hanghoa" method="post">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Search" name="input_data1">
                    <button class="btn btn-outline-dark" type="submit">Find</button>
                </div>
            </form>
            <p class="fs-5 ms-2 mt-5">Tên hàng</p>
            <form action="/hanghoa" method="post">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Search" name="input_data3">
                    <button class="btn btn-outline-dark" type="submit">Find</button>
                </div>
            </form>
        </div>
        <div class="grid-item">
            <div class="container">
                <table id="example" class="table table-striped table-hover table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">Mã hàng</th>
                            <th scope="col">Tên hàng</th>
                            <th scope="col">Phân loại</th>
                            <th scope="col">Giá nhập</th>
                            <th scope="col">Giá bán</th>
                            <th scope="col">Tồn kho</th>
                            <th scope="col">Sửa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for (let i=0; i < dulieu.length; i++) { %>
                            <tr>
                                <td id="productId">
                                    <%= dulieu[i].product_id %>
                                </td>
                                <td>
                                    <%= dulieu[i].name %>
                                </td>
                                <td>
                                    <%= dulieu[i].category_name %>
                                </td>
                                <td>
                                    <%= dulieu[i].inbound_price %>
                                </td>
                                <td>
                                    <%= dulieu[i].outbound_price %>
                                </td>
                                <td>
                                    <%= dulieu[i].quantity %>
                                </td>
                                <td data-bs-toggle="modal" data-bs-target="#detailModal" class="text-center"
                                    data-productid="<%= dulieu[i].product_id %>">
                                    <img src="/img/navbar/pencil.svg">
                                </td>
                            </tr>
                            <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Set up the event listener for the product update button
            $('#updateButton').click(function () {
                // Make an AJAX request to update the product details
                $.ajax({
                    type: 'POST',
                    url: '/hanghoa/chinhsua',
                    data: $('#updateForm').serialize(),
                    success: function (response) {
                        // Handle the server response if needed
                        console.log(response);
                        // Close the modal
                        $('#detailModal').modal('hide');
                        // Reload the page or update the data as needed
                        location.reload();
                    },
                    error: function (error) {
                        console.error(error);
                    }
                });
            });

            // Set up the modal event when it's shown
            $('#detailModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var productId = button.data('productid');
                var modal = $(this);

                // Make an AJAX request to get product details based on productCode
                $.ajax({
                    type: 'POST',
                    url: '/hanghoa/chinhsua/info',
                    data: { productId: productId },
                    success: function (data) {
                        // Fill in the form with product details
                        modal.find('#productId').text(data.product_id);
                        modal.find('#newName').val(data.name);
                        modal.find('#newCategory').val(data.product_category_id);
                        modal.find('#newInboundPrice').val(data.inbound_price);
                        modal.find('#newOutboundPrice').val(data.outbound_price);
                        modal.find('#newQuantity').val(data.quantity);
                        modal.find('#productIdInput').val(data.product_id);
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        });        
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="./index.js" charset="UTF-8"></script>
</body>
</body>

</html>